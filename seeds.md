# Seeding the Application

For development and testing purposes a developer may want to work with a large data set. If they were forced to achieve a large dataset by creating each record one-by-one it would waste valuable time and effort. The solution is [seeding the database](https://en.wikipedia.org/wiki/Database_seeding). To make this process even more effecient (_and fun_) we will be utilizing the [Faker](https://github.com/faker-ruby/faker) gem.

## Step 1 - Installing Faker

To start using `Faker`, first add it to your `Gemfile`: 
```rb
# bnb-library/Gemfile
---------------------

gem 'devise'
gem 'trestle-auth'
gem 'faker', :git => 'https://github.com/faker-ruby/faker.git', :branch => 'master'
```
Bundle your Gemfile: 
```
dip bundle install
```
We will setup a [rake task](https://docs.ruby-lang.org/en/2.2.0/Rake/Task.html) so that we can create all of our data in one reusable command.

## Step 2 - Build a Rake Task
Your application contains a folder called `tasks` in `bnb-library/lib`. Create a file titled `populate.rake`.
```rb
# lib/tasks/populate.rake
```
To this file add the content:
```rb
# lib/tasks/populate.rake
-------------------------

require 'faker'

namespace :populate do
  task :books => :environment do
    Book.create(
      title: Faker::Book.unique.title,
      price: Faker::Number.decimal(l_digits: 3, r_digits: 2),
      description: Faker::Hacker.say_something_smart
    )
  end
end
```
We are requiring the `faker` module to have access to its functionality in this file.

When the `:populate` task is ran it is going to create a new `book` instance with the fields of `:title`, `:price`, and `:description` all containing fake (and humorous) data generated by `Faker`'s api.

Save and close the file when you are finished.

Open `db/seeds.rb`. Here we are going to add: 
```rb
# db/seeds.rb
-------------
[
  {email: "nathan@brandnewbox.com"},
  {email: "matt@brandnewbox.com"},
  {email: "will@brandnewbox.com"},
  {email: "josh@brandnewbox.com"},
  {email: "isaac@brandnewbox.com"},
  {email: "ashley@brandnewbox.com"},
  {email: "youremail@mail.com"}
].each do |user|
  new_user = User.find_or_initialize_by(email: user[:email])
  if new_user.new_record?
    new_user.password = "password"
    new_user.update!(user)
  end
end

100.times {
  Rake::Task['populate:books'].invoke
  Rake::Task['populate:books'].reenable
}
```
We will create valid `Users` and assign a very secure password of `password` to each `user`. This is common practice in development.

We will also invoke our `populate:books` `rake task` 100 times populating our database with a whole host of books. By default `Rake` only allows a task to be run once, so we are including the `:reenable` method which allows a task to be ran multiple times.

Seed the database: 
```
dip rails db:seed
```
If you navigate to `localhost:3000/admin` you will now be able to login and view the `/admin` views using the credentials created above.


Our `index` view of `books` have become congested with a growing list of books:
![haml view](images/seeds/book-index.png)
For a final step, let's add pagination to clean up our views. 